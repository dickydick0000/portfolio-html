<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Chaesa Kitchen - Premium Homemade</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --brand-primary: #78350f; --brand-secondary: #b45309; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: contain; background-color: #f3f4f6; }
        .safe-area-top { padding-top: env(safe-area-inset-top); }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .meat-gradient { background: linear-gradient(135deg, #78350f 0%, #b45309 100%); position: relative; }
        .kitchen-pattern { position: absolute; inset: 0; opacity: 0.12; background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='1' fill-rule='evenodd'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/svg%3E"); mask-image: linear-gradient(to bottom, black, transparent); }
        .ornament-layer { position: absolute; inset: 0; pointer-events: none; overflow: hidden; display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; padding: 10px; opacity: 0.15; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        [v-cloak] { display: none; }
        .card-shadow { box-shadow: 0 4px 20px -2px rgba(0,0,0,0.05); }
        .active-scale:active { transform: scale(0.96); transition: transform 0.1s; }
        .tab-active { background: var(--brand-primary); color: white; box-shadow: 0 4px 12px rgba(120, 53, 15, 0.2); }
        .nav-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .custom-select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2378350f'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1rem; padding-right: 1.5rem; padding-left: 0.75rem; }
        .admin-input { background: #fdf2f2; border: 1px solid #fed7d7; border-radius: 8px; padding: 4px 8px; font-weight: bold; color: #78350f; width: 100%; outline: none; }
    </style>
</head>
<body class="bg-gray-100">

<div id="app" v-cloak class="max-w-md mx-auto min-h-screen bg-white relative flex flex-col shadow-2xl">
    <header class="meat-gradient px-6 pt-12 pb-8 rounded-b-[2.5rem] overflow-hidden shrink-0 safe-area-top">
        <div class="kitchen-pattern"></div>
        <div class="flex justify-between items-start relative z-10">
            <div class="flex items-center gap-3">
                <div class="w-16 h-16 bg-white rounded-full p-0.5 shadow-xl border border-white/20 overflow-hidden flex items-center justify-center">
                    <img src="image/logo.png" class="w-full h-full object-contain" onerror="this.src='https://via.placeholder.com/100?text=LOGO'">
                </div>
                <div>
                    <h1 class="text-2xl font-extrabold tracking-tight text-white leading-none">Chaesa Kitchen</h1>
                    <p class="text-orange-200/80 text-[10px] uppercase font-bold tracking-[0.2em] mt-1">Premium Homemade Food</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button @click="chatAdmin" class="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center backdrop-blur-md active-scale">
                    <i class="fab fa-whatsapp text-lg text-green-300"></i>
                </button>
                <button @click="toggleAdmin" class="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center backdrop-blur-md active-scale">
                    <i class="fas" :class="isLoggedIn ? 'fa-unlock text-orange-200' : 'fa-lock text-white'"></i>
                </button>
            </div>
        </div>

        <div class="mt-6 min-h-[60px] relative z-10">
            <div class="bg-black/20 backdrop-blur-md p-3 rounded-2xl border border-white/10" v-if="config.showPromo || isLoggedIn">
                <div class="flex justify-between items-center mb-1">
                    <p class="text-orange-200 text-[8px] font-black uppercase tracking-widest">Promo Hari Ini</p>
                    <div v-if="isLoggedIn" @click="config.showPromo = !config.showPromo; saveToFirebase()" class="cursor-pointer">
                        <i class="fas text-white" :class="config.showPromo ? 'fa-toggle-on text-green-400' : 'fa-toggle-off'"></i>
                    </div>
                </div>
                <div v-if="!isLoggedIn" class="text-white text-xs font-bold">{{ config.promoText }}</div>
                <input v-else type="text" v-model="config.promoText" @change="saveToFirebase" class="bg-white/10 text-white text-xs w-full outline-none border-b border-white/30">
            </div>
        </div>
    </header>

    <nav class="sticky top-0 bg-white/95 backdrop-blur-md z-30 px-4 py-4 border-b border-gray-100">
        <div class="nav-grid">
            <button v-for="cat in categories" @click="activeTab = cat" :class="activeTab === cat ? 'tab-active' : 'bg-gray-50 text-gray-400'" class="py-2.5 rounded-xl text-[9px] font-bold uppercase transition-all">
                {{ cat }}
            </button>
        </div>
    </nav>

    <main class="flex-1 px-4 pt-4 pb-32 overflow-y-auto bg-gray-50/50">
        <div v-if="loading" class="flex flex-col items-center justify-center py-10">
            <div class="w-8 h-8 border-4 border-amber-900 border-t-transparent rounded-full animate-spin"></div>
        </div>

        <div v-if="showLogin" class="mb-6 p-6 bg-white rounded-3xl border border-orange-100 shadow-sm">
            <input type="password" v-model="passInput" @keyup.enter="login" placeholder="Pin Akses" class="w-full p-4 rounded-2xl bg-gray-50 text-center font-bold outline-none mb-3">
            <button @click="login" class="w-full bg-amber-900 text-white py-4 rounded-2xl font-bold text-xs">AKSES ADMIN</button>
        </div>

        <div class="space-y-4">
            <div v-for="(item, index) in filteredProducts" :key="index" class="bg-white p-4 rounded-3xl border border-gray-100 card-shadow flex gap-4">
                <div class="w-14 h-14 bg-orange-50 rounded-2xl flex items-center justify-center shrink-0">
                    <i class="fas fa-cookie-bite text-orange-600 text-xl"></i>
                </div>
                <div class="flex-1">
                    <div v-if="!isLoggedIn">
                        <h4 class="font-bold text-gray-800 text-sm">{{ item.name }}</h4>
                        <p class="text-[10px] text-gray-400 font-bold uppercase">{{ item.stock }} {{ item.unit }} Tersedia</p>
                        <div class="text-amber-900 font-black text-lg">Rp {{ item.price.toLocaleString() }}</div>
                    </div>
                    <div v-else class="space-y-2">
                        <input v-model="item.name" @change="saveToFirebase" class="admin-input text-xs" placeholder="Nama">
                        <div class="flex gap-2">
                            <input type="number" v-model.number="item.price" @change="saveToFirebase" class="admin-input text-xs" placeholder="Harga">
                            <input type="number" v-model.number="item.stock" @change="saveToFirebase" class="admin-input text-xs" placeholder="Stok">
                        </div>
                    </div>
                </div>
                <div v-if="!isLoggedIn && item.stock > 0">
                    <select :value="getQty(item.name)" @change="setQty(item, $event)" class="custom-select bg-orange-50 h-10 w-16 rounded-xl font-bold">
                        <option value="0">0</option>
                        <option v-for="n in Math.min(item.stock, 10)" :value="n">{{n}}</option>
                    </select>
                </div>
                <button v-if="isLoggedIn" @click="removeProduct(index)" class="text-red-400 p-2"><i class="fas fa-trash"></i></button>
            </div>
        </div>

        <button v-if="isLoggedIn" @click="addProduct" class="w-full mt-6 py-4 border-2 border-dashed rounded-3xl text-gray-400 font-bold text-xs uppercase">+ Tambah Menu</button>
    </main>

    <div v-if="cartTotal > 0 && !showCart" @click="showCart = true" class="fixed bottom-6 left-4 right-4 bg-amber-900 text-white p-2 rounded-2xl flex items-center shadow-2xl z-40 max-w-md mx-auto">
        <div class="bg-orange-500 w-12 h-12 rounded-full flex items-center justify-center text-xl shrink-0"><i class="fas fa-shopping-cart"></i></div>
        <div class="ml-4 flex-1">
            <p class="text-[9px] font-bold text-orange-200 uppercase">{{ cartTotal }} Item</p>
            <p class="text-sm font-black">Rp {{ totalPrice.toLocaleString() }}</p>
        </div>
        <div class="bg-white/10 px-6 py-3 rounded-full text-[10px] font-black uppercase mr-1">Check Out</div>
    </div>

    <div v-if="showCart" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex flex-col justify-end">
        <div class="bg-white rounded-t-[3rem] p-8 max-w-md mx-auto w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-black">Detail Pesanan</h2>
                <button @click="showCart = false"><i class="fas fa-times text-gray-400"></i></button>
            </div>
            <div class="space-y-3 mb-6">
                <input v-model="form.name" placeholder="Nama Lengkap" class="w-full bg-gray-50 p-4 rounded-2xl border-none font-bold outline-none">
                <textarea v-model="form.address" placeholder="Alamat Lengkap" class="w-full bg-gray-50 p-4 rounded-2xl border-none font-bold outline-none h-24"></textarea>
            </div>
            <div class="border-t pt-4">
                <p class="text-[10px] font-bold text-gray-400 uppercase">Total Bayar</p>
                <p class="text-2xl font-black text-amber-900 mb-6">Rp {{ totalPrice.toLocaleString() }}</p>
                <button @click="checkout" class="w-full bg-amber-900 text-white py-5 rounded-2xl font-black text-sm shadow-xl">PESAN VIA WHATSAPP</button>
            </div>
        </div>
    </div>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyC6-_DzKDuyUBPJxYYBSAKvzqRZgdhYwvM",
    authDomain: "chaesa-kitchen.firebaseapp.com",
    databaseURL: "https://chaesa-kitchen-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "chaesa-kitchen",
    storageBucket: "chaesa-kitchen.firebasestorage.app",
    messagingSenderId: "175144810502",
    appId: "1:175144810502:web:7a17bd57c8e41575d5ab87"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

Vue.createApp({
    data() {
        return {
            loading: true, isLoggedIn: false, showLogin: false, showCart: false,
            passInput: '', activeTab: 'semua',
            categories: ['semua', 'risol', 'brownies', 'lain lain'],
            products: [], cart: [],
            config: { promoText: 'Diskon Spesial Hari Ini!', showPromo: true },
            form: { name: '', address: '' },
            waNumber: '6285385978915'
        }
    },
    computed: {
        filteredProducts() { return this.activeTab === 'semua' ? this.products : this.products.filter(p => p.category === this.activeTab); },
        cartTotal() { return this.cart.reduce((s, i) => s + i.qty, 0); },
        totalPrice() { return this.cart.reduce((s, i) => s + (i.price * i.qty), 0); }
    },
    methods: {
        fetchData() {
            db.ref('kitchen_data').on('value', (snap) => {
                const data = snap.val();
                if (data) {
                    this.products = data.products || [];
                    this.config = data.config || this.config;
                }
                this.loading = false;
            });
        },
        async saveToFirebase() {
            await db.ref('kitchen_data').set({ products: this.products, config: this.config });
        },
        toggleAdmin() { if(this.isLoggedIn) this.isLoggedIn = false; else this.showLogin = !this.showLogin; },
        login() { if(this.passInput === 'admin123') { this.isLoggedIn = true; this.showLogin = false; this.passInput = ''; } else alert("Salah!"); },
        setQty(prod, e) {
            const q = parseInt(e.target.value);
            const idx = this.cart.findIndex(c => c.name === prod.name);
            if (q === 0) { if (idx > -1) this.cart.splice(idx, 1); }
            else { if (idx > -1) this.cart[idx].qty = q; else this.cart.push({ ...prod, qty: q }); }
        },
        getQty(name) { const item = this.cart.find(c => c.name === name); return item ? item.qty : 0; },
        addProduct() { this.products.unshift({ name: 'Menu Baru', price: 0, stock: 10, category: 'lain lain', unit: 'pcs' }); this.saveToFirebase(); },
        removeProduct(i) { if(confirm('Hapus?')) { this.products.splice(i, 1); this.saveToFirebase(); } },
        async checkout() {
            if(!this.form.name || !this.form.address) return alert("Isi data!");
            let msg = `*PESANAN CHAESA KITCHEN*\nNama: ${this.form.name}\nAlamat: ${this.form.address}\n\n`;
            this.cart.forEach(i => { 
                msg += `- ${i.name} x${i.qty} = Rp ${(i.price*i.qty).toLocaleString()}\n`;
                const p = this.products.find(pr => pr.name === i.name);
                if(p) p.stock -= i.qty;
            });
            msg += `\n*TOTAL: Rp ${this.totalPrice.toLocaleString()}*`;
            await this.saveToFirebase();
            window.open(`https://wa.me/${this.waNumber}?text=${encodeURIComponent(msg)}`);
            this.cart = []; this.showCart = false;
        },
        chatAdmin() { window.open(`https://wa.me/${this.waNumber}?text=Halo Chaesa Kitchen...`); }
    },
    mounted() { this.fetchData(); }
}).mount('#app');
</script>
</body>
</html>
